<!DOCTYPE html>
<html lang="ja">
<head>
    <!-- メタ情報 -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">

    <title>Title</title>

    <!-- Import CSS -->
    <link rel="stylesheet" href="normalize.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <a href="index.html"><h1>Bookmark Tool</h1></a>
    </header>

    <div id="display_add" class="btn_right">
        <button onclick="display_add_form()">ADD</button>
    </div>

    <!-- 追加フォーム -->
    <div id="add" class="bookmark_form">
        <div id="error">ERROR：<span id="error_message"></span></div>

        <ul>
            <li>
                <label for="add_title">TITLE</label>
                <input type="text" id="add_title">
            </li>
            <li>
                <label for="add_tag">TAG</label>
                <input type="text" id="add_tag">
            </li>
            <li>
                <label for="add_url">URL</label>
                <input type="text" id="add_url">
            </li>
            <li>
                <label for="add_description">DESCRIPTION</label>
                <input type="text" id="add_description">
            </li>
        </ul>

        <div class="btn_right">
            <button onclick="js_add_bookmark()">ADD</button>
        </div>
    </div>

    <!-- 詳細フォーム -->
    <div id="detail" class="bookmark_form">
        <ul>
            <li>
                <label for="detail_title">TITLE</label>
                <input type="text" id="detail_title">
            </li>
            <li>
                <label for="detail_tag">TAG</label>
                <input type="text" id="detail_tag">
            </li>
            <li>
                <label for="detail_url">URL</label>
                <input type="text" id="detail_url">
            </li>
            <li>
                <label for="detail_description">DESCRIPTION</label>
                <input type="text" id="detail_description">
            </li>
        </ul>

        <div class="btn_right">
            <button onclick="js_update_bookmark()">UPDATE</button>
            <button onclick="js_delete_bookmark()">DELETE</button>
            <button><a id="open_link" target="_blank">OPEN</a></button>
        </div>
    </div>

    <div id="bookmarks">
        <table>
            <thead>
                <tr>
                    <th>TAG</th>
                    <th>TITLE</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>

    <!-- Import JavaScript -->
    <script type="text/javascript" src="/eel.js"></script>
    <script>
        function display_add_form() {
            document.getElementById("display_add").style.display = "none";
            document.getElementById("bookmarks").style.display = "none";
            document.getElementById("add").style.display = "block";
        }

        async function js_get_bookmark() {
            let html_bookmarks = '';
            let bookmarks = await eel.get_bookmark()();

            for (let i = 0; i < bookmarks.length; i++) {
                html_bookmarks += "<tr onclick='js_click_record(\"" + bookmarks[i][2] + "\")'>";
                html_bookmarks += "<td>" + bookmarks[i][1] + "</td>";
                html_bookmarks += "<td>" + bookmarks[i][0] + "</td>";
                html_bookmarks += "</tr>";
            }
            document.querySelector('div#bookmarks table tbody').innerHTML = html_bookmarks;
        }
        js_get_bookmark();

        async function js_add_bookmark() {
            let title = document.getElementById("add_title").value;
            let tag = document.getElementById("add_tag").value;
            let url = document.getElementById("add_url").value;
            let description = document.getElementById("add_description").value;

            if (title === "" || tag === "" || url === "") {
                document.getElementById("error").style.display = "block";
                document.getElementById("error_message").innerHTML = "DESCRIPTION以外は入力してください。";
            } else {
                let result = await eel.add_bookmark(title, tag, url, description)();

                if (result === true) {
                    window.location.href = "index.html";
                } else {
                    document.getElementById("error").style.display = "block";
                    document.getElementById("error_message").innerHTML = "すでに同じURLが存在します。";
                }
            }
        }

        async function js_click_record(url) {
            document.getElementById("display_add").style.display = "none";
            document.getElementById("bookmarks").style.display = "none";
            document.getElementById("detail").style.display = "block";

            let bookmark = await eel.detail_bookmark(url)();

            document.getElementById("detail_title").value = bookmark[0];
            document.getElementById("detail_tag").value = bookmark[1];
            document.getElementById("detail_url").value = bookmark[2];
            document.getElementById("detail_description").value = bookmark[3];

            document.getElementById("open_link").href = bookmark[2];
        }

        async function js_delete_bookmark() {
            await eel.delete_bookmark(document.getElementById("detail_url").value)();
            window.location.href = "index.html";
        }

        async function js_update_bookmark() {
            await eel.update_bookmark(
                document.getElementById("detail_title").value,
                document.getElementById("detail_tag").value,
                document.getElementById("detail_url").value,
                document.getElementById("detail_description").value,
            )
            window.location.href = "index.html";
        }
    </script>
</body>
</html>